# Usage:
#
#   ecsdeploy \
#     [ generage-compose | deploy ]
#     -e eoe \
#     -r us-west-1 \
#     -s audit-support \
#     -v 2.85.0 \
#     -cfg 'service.desired_count=10' \
#     -var 'debug=False'
#
service:
  name: audit-support
  deployment:
    maximum_percent: 0
    minimum_healthy_percent: 0
  desired_count: 0
  load_balancers:
    http_port:
      container_name: el-auditsupport
      container_port: 8000

environment_variables:
  debug: False
  tty: True

task:
  volumes:
    global_settings: /etc/elastica/global_settings.conf
    container_logs: /var/log/elastica/el-container-logs

  containers:
    el-auditsupport:
      memory: 2048
      essential: True
      port_mappings:
        -
          host_port: 0
          container_port: 8000
          protocol: tcp
      mount_points:
        /etc/elastica/global_settings.conf:
          source_volume: global_settings
          read_only: True
        /app-logs:
          source_volume: container_logs

environments:
  eoe:
    namespaces: dev
    environment_variables:
      debug: True
    us-west-1:
      service:
        desired_count: 1
        loadBalancers:
          http_port:
            targetGroupArn: {{ SOME ARN }}
